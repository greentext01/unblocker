rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
  	function isAdmin() {
    	return exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
    
    match /games/{gameId} {
      allow read;
      allow create: if request.resource.data.approved == false && validateGame();

      allow update: if isAdmin() && validateGame();

      function validateGame() {
        return request.resource.data.name is string &&
          request.resource.data.runs == [] &&
          request.resource.data.url is string &&
          request.resource.data.category is string &&
          request.resource.data.category in ['Site', 'Other', 'Puzzle', 'Skill', 'Level'] &&
          request.auth != null;
      }
    }
    
    match /admins/{adminId} {
    	allow write: if false;
      allow read;
    }
  }
}